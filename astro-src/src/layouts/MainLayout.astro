---
import { type Language } from '../i18n/utils';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  lang: Language;
  keywords?: string;
}

const { title, description, lang, keywords } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    {keywords && <meta name="keywords" content={keywords} />}
    <link rel="canonical" href={canonicalURL} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />

    <!-- Apple System Fonts - No external font loading needed -->
    <!-- Using -apple-system, BlinkMacSystemFont, SF Pro Display/Text -->

    <!-- Icons - Now using Lucide (modern, tree-shakeable) -->
    <!-- Font Awesome removed for better performance -->

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6320666588"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-6320666588', {
        'send_page_view': true,
        'cookie_flags': 'SameSite=None;Secure'
      });

      // Track CTA clicks
      window.trackEvent = function(category, action, label) {
        gtag('event', action, {
          'event_category': category,
          'event_label': label
        });
      };
    </script>

    <!-- Schema Markup - Person/Professional Service -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": ["Person", "ProfessionalService"],
      "name": "Emanuel Aaron Flury",
      "jobTitle": "Automation Specialist",
      "description": "Swiss automation expert specializing in AI-driven finance solutions for global teams and Swiss expatriates",
      "url": "https://eflury.com",
      "email": "me@eflury.com",
      "telephone": "+41 79 910 77 87",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Grenchen",
        "addressCountry": "Switzerland"
      },
      "worksFor": {
        "@type": "Organization",
        "name": "Johnson & Johnson"
      },
      "founder": {
        "@type": "Organization",
        "name": "Taxed GmbH"
      },
      "knowsAbout": ["AI Automation", "Swiss Tax Consulting", "Power BI", "UiPath", "Python", "Financial Analytics"],
      "alumniOf": ["University of Aberdeen", "University of Wisconsin - La Crosse"],
      "award": "Royal Yachting Association Day Skipper",
      "sameAs": [
        "https://linkedin.com/in/emanuelflury",
        "https://github.com/taxedgmbh"
      ],
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Professional Services",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Automation Consulting",
              "description": "Transform your business processes with cutting-edge AI and automation solutions. From RPA to intelligent workflows.",
              "provider": {
                "@type": "Person",
                "name": "Emanuel Aaron Flury"
              },
              "serviceType": "Business Process Automation"
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Swiss Tax Consulting",
              "description": "Expert tax advice for Swiss residents and expatriates. Navigate complex Swiss tax regulations with confidence.",
              "provider": {
                "@type": "Person",
                "name": "Emanuel Aaron Flury"
              },
              "serviceType": "Tax Consulting",
              "areaServed": "Switzerland"
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Financial Analytics",
              "description": "Data-driven insights through powerful dashboards and reporting with Power BI and advanced analytics.",
              "provider": {
                "@type": "Person",
                "name": "Emanuel Aaron Flury"
              },
              "serviceType": "Business Intelligence"
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Corporate Consulting",
              "description": "Strategic guidance for international business operations leveraging Fortune 500 experience.",
              "provider": {
                "@type": "Person",
                "name": "Emanuel Aaron Flury"
              },
              "serviceType": "Management Consulting"
            }
          }
        ]
      },
      "review": [
        {
          "@type": "Review",
          "author": {
            "@type": "Person",
            "name": "Sarah Mitchell"
          },
          "reviewRating": {
            "@type": "Rating",
            "ratingValue": "5",
            "bestRating": "5"
          },
          "reviewBody": "Emanuel's automation expertise transformed our month-end close process. What used to take 2 weeks now takes 3 days. His attention to detail and deep understanding of finance operations is exceptional.",
          "datePublished": "2024-06-15"
        },
        {
          "@type": "Review",
          "author": {
            "@type": "Person",
            "name": "Andreas Weber"
          },
          "reviewRating": {
            "@type": "Rating",
            "ratingValue": "5",
            "bestRating": "5"
          },
          "reviewBody": "Working with Emanuel on our tax automation platform was a game-changer. He combines technical excellence with real-world business acumen. Highly recommended for any automation project.",
          "datePublished": "2024-08-20"
        },
        {
          "@type": "Review",
          "author": {
            "@type": "Person",
            "name": "Jennifer Thompson"
          },
          "reviewRating": {
            "@type": "Rating",
            "ratingValue": "5",
            "bestRating": "5"
          },
          "reviewBody": "Emanuel delivered a Power BI solution that exceeded our expectations. The dashboards he built provide insights we never knew we needed. ROI was achieved within 3 months.",
          "datePublished": "2024-09-10"
        }
      ],
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "5",
        "reviewCount": "3",
        "bestRating": "5",
        "worstRating": "5"
      }
    }
    </script>

    <!-- FAQ Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Do you work with international clients?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes! I work with clients globally, particularly those with operations in Switzerland or requiring Swiss tax expertise. My automation consulting services are available worldwide, and I have experience with multinational corporations and remote collaboration."
          }
        },
        {
          "@type": "Question",
          "name": "What's your typical project timeline?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Project timelines vary based on scope and complexity. A typical automation project ranges from 2-12 weeks, while tax consulting engagements can be ongoing. I provide detailed timelines during our initial consultation after understanding your specific requirements."
          }
        },
        {
          "@type": "Question",
          "name": "How do you charge for your services?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "I offer flexible pricing models including hourly rates, fixed-price projects, and retainer agreements. Pricing depends on project complexity, timeline, and deliverables. Contact me for a custom quote tailored to your needs."
          }
        },
        {
          "@type": "Question",
          "name": "What automation platforms do you specialize in?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "I specialize in UiPath, Power Automate, Python automation, and custom solutions. I have extensive experience with RPA (Robotic Process Automation), AI integration, workflow automation, and data analytics using Power BI."
          }
        }
      ]
    }
    </script>

    <!-- Dark Mode Script - Prevent Flash -->
    <script is:inline>
      // Initialize theme before page renders to prevent flash
      const theme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', theme);
    </script>

    <!-- Keyboard Navigation Detection -->
    <script is:inline>
      // Add class when user is tabbing for better accessibility
      function handleFirstTab(e) {
        if (e.key === 'Tab') {
          document.body.classList.add('user-is-tabbing');
          window.removeEventListener('keydown', handleFirstTab);
          window.addEventListener('mousedown', handleMouseDownOnce);
        }
      }

      function handleMouseDownOnce() {
        document.body.classList.remove('user-is-tabbing');
        window.removeEventListener('mousedown', handleMouseDownOnce);
        window.addEventListener('keydown', handleFirstTab);
      }

      window.addEventListener('keydown', handleFirstTab);
    </script>

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#007AFF" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Emanuel Flury" />

    <!-- Service Worker Registration -->
    <script is:inline>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('SW registered:', registration.scope);
            })
            .catch((error) => {
              console.log('SW registration failed:', error);
            });
        });
      }
    </script>

    <!-- Modern Web APIs -->
    <script is:inline>
      // Web Share API
      if (navigator.share) {
        window.sharePage = async function() {
          try {
            await navigator.share({
              title: document.title,
              text: document.querySelector('meta[name="description"]')?.content || '',
              url: window.location.href
            });
          } catch (err) {
            console.log('Share cancelled');
          }
        };
      }

      // Intersection Observer for animations
      if ('IntersectionObserver' in window) {
        const observerOptions = {
          root: null,
          rootMargin: '0px',
          threshold: 0.1
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('animate-in');
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);

        // Observe elements with data-animate attribute
        document.addEventListener('DOMContentLoaded', () => {
          document.querySelectorAll('[data-animate]').forEach(el => {
            observer.observe(el);
          });
        });
      }
    </script>
  </head>
  <body>
    <slot />
  </body>
</html>
